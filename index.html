<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
    <title>Ligue de Football à 6</title>
    <style>
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f4f7f6;
        color: #333;
        min-height: 100vh;
    }
    .container {
        width: 100%;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        box-sizing: border-box;
    }
    header {
        background-color: #3d195b;
        color: white;
        padding: 15px 10px;
        text-align: center;
        border-radius: 5px;
        margin-bottom: 20px;
    }
    h1, h2, h3 {
        margin: 0;
        padding: 0;
    }
    h4 {
        margin: 10px 0 5px 0;
        color: #3d195b;
    }
    .section {
        background-color: white;
        border-radius: 5px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        padding: 15px;
        margin-bottom: 20px;
        width: 100%;
        box-sizing: border-box;
    }
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
        table-layout: auto;
    }
    th, td {
        padding: 10px;
        text-align: left;
        border-bottom: 1px solid #ddd;
        word-break: break-word;
    }
    th {
        background-color: #f2f2f2;
        font-weight: bold;
    }
    tr:hover {
        background-color: #f5f5f5;
    }
    .team-container {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        margin-top: 20px;
        width: 100%;
    }
    .team-card {
        background-color: white;
        border-radius: 5px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        padding: 15px;
        flex: 1 1 calc(50% - 20px);
        min-width: 0;
        box-sizing: border-box;
    }
    .team-card h3 {
        color: #3d195b;
        border-bottom: 2px solid #3d195b;
        padding-bottom: 5px;
        margin-bottom: 10px;
        font-size: 1.2rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .player {
        padding: 5px 0;
        border-bottom: 1px solid #eee;
        font-size: 0.9rem;
    }
    .player:last-child {
        border-bottom: none;
    }
    .goalkeeper {
        font-weight: bold;
    }
    .transferred-out {
        font-style: italic;
        background-color: #f9f9f9;
    }
    .transferred-out .player-points {
        font-weight: bold;
    }
    .transferred-in {
        color: #4caf50;
        font-weight: bold;
        position: relative;
    }
    .transferred-in::before {
        margin-right: 5px;
        font-size: 0.8rem;
    }
    
    .transfer-period {
        background-color: #fff3e0;
        border-left: 4px solid #ff9800;
        padding: 10px;
        margin: 10px 0;
        border-radius: 3px;
    }
    .transfer-period h4 {
        color: #e65100;
        margin-top: 0;
    }
    .transfers-section {
        margin-top: 15px;
        padding-top: 10px;
        border-top: 2px dashed #ff9800;
    }
    .tabs {
        display: flex;
        margin-bottom: 15px;
        overflow-x: auto;
        white-space: nowrap;
        padding-bottom: 5px;
    }
    .tab {
        padding: 8px 15px;
        background-color: #e0e0e0;
        border: none;
        cursor: pointer;
        margin-right: 5px;
        border-radius: 5px 5px 5px 5px;
        font-size: 0.9rem;
        flex-shrink: 0;
    }
    .tab.active {
        background-color: #3d195b;
        color: white;
    }
    .tab-content {
        display: none;
        width: 100%;
    }
    .tab-content.active {
        display: block;
    }
    .loading {
        text-align: center;
        padding: 30px;
        font-size: 16px;
        color: #777;
    }
    /* Enhanced Bracket Styles */
    .bracket-section {
        width: 100%;
        overflow-x: auto;
        padding-bottom: 20px;
        -webkit-overflow-scrolling: touch;
    }
    
    .bracket-container {
        display: flex;
        justify-content: flex-start;
        gap: 10px;
        min-width: fit-content;
        align-items: flex-start;
        padding: 15px 10px;
    }
    
    .bracket-round {
        display: flex;
        flex-direction: column;
        justify-content: flex-around;
        min-width: 160px;
    }
    
    .bracket-round-title {
        text-align: center;
        font-weight: bold;
        color: #3d195b;
        margin-bottom: 15px;
        padding: 8px 5px;
        background-color: #f8f5ff;
        border-radius: 4px;
        font-size: 0.9rem;
        position: sticky;
        left: 0;
    }
    
    .bracket-match {
        background-color: white;
        border-radius: 6px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        padding: 10px;
        margin-bottom: 20px;
        position: relative;
        transition: all 0.3s ease;
        min-height: 80px;
        display: flex;
        flex-direction: column;
        justify-content: center;
    }
    
    .bracket-match:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }
    
    .bracket-match.winner {
        background-color: rgba(61, 25, 91, 0.1);
        border: 1px solid #3d195b;
    }
    
    .bracket-team {
        display: flex;
        align-items: center;
        padding: 6px 8px;
        margin: 3px 0;
        border-radius: 4px;
        position: relative;
        min-height: 28px;
    }
    
    .bracket-team.winner {
        font-weight: bold;
        color: #3d195b;
    }
    
    .bracket-team.winner::before {
        content: "✓";
        margin-right: 5px;
        color: #4caf50;
    }
    .penalty-score {
        font-size: 0.8em;
        color: #888;
        margin-left: 5px;
    }
    .match-date {
        font-size: 0.7em;
        color: #666;
        text-align: center;
        margin-top: 5px;
        font-style: italic;
    }
    /* Connector lines between rounds */
    .bracket-team::before {
        content: "";
        position: absolute;
        left: -10px;
        top: 50%;
        width: 10px;
        height: 2px;
        background: #aaa;
        display: none;
    }
    
    .bracket-team::after {
        content: "";
        position: absolute;
        left: -10px;
        width: 2px;
        background: #aaa;
        display: none;
    }
    
    .bracket-team.top::after {
        top: 50%;
        bottom: -20px;
    }
    
    .bracket-team.bottom::after {
        top: -20px;
        bottom: 50%;
    }
    
    .bracket-round:not(:first-child) .bracket-team::before,
    .bracket-round:not(:first-child) .bracket-team::after {
        display: block;
    }
    
    .bracket-score {
        margin-left: auto;
        padding-left: 8px;
        font-weight: bold;
        color: #666;
    }
    
    .bracket-team.winner .bracket-score {
        color: #e90052;
    }
    
    /* Special styling for different rounds */
    .bracket-round-32 .bracket-round-title {
        background-color: #e8f5e9;
    }
    
    .bracket-round-16 .bracket-round-title {
        background-color: #e3f2fd;
    }
    
    .bracket-round-8 .bracket-round-title {
        background-color: #fff8e1;
    }
    
    .bracket-round-4 .bracket-round-title {
        background-color: #fce4ec;
    }
    
    .bracket-round-2 .bracket-round-title {
        background-color: #f3e5f5;
        font-size: 1rem;
    }
    
    .bracket-final {
        background-color: #f5f5f5;
    }
    
    .bracket-final .bracket-match {
        background-color: #3d195b;
        color: white;
    }
    
    .bracket-final .bracket-team {
        color: white;
    }
    
    .bracket-final .bracket-team.winner {
        color: #ffeb3b;
    }
    
    .bracket-final .bracket-score {
        color: #ccc;
    }
    
    
    /* Styles pour le terrain de football */
    .field-container {
        margin-top: 15px;
        display: flex;
        flex-direction: column;
        width: 100%;
    }
    
    /* Nouveau layout pour le terrain et les joueurs sortis */
    .field-wrapper {
        position: relative;
        width: 100%;
        margin-bottom: 20px;
    }
    
    .soccer-field {
        position: relative;
        width: 100%;
        height: 220px;
        background-color: #75c043;
        border: 2px solid white;
        border-radius: 5px;
        overflow: visible;
        margin-bottom: 5px;
    }
    
    .field-line {
        position: absolute;
        background-color: white;
    }
    .center-circle {
        position: absolute;
        width: 60px;
        height: 60px;
        border: 2px solid white;
        border-radius: 50%;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
    }
    .center-spot {
        position: absolute;
        width: 6px;
        height: 6px;
        background-color: white;
        border-radius: 50%;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
    }
    .goal-box-left, .goal-box-right {
        position: absolute;
        width: 30px;
        height: 60px;
        border: 2px solid white;
        top: 50%;
        transform: translateY(-50%);
    }
    .goal-box-left {
        border-left: none;
        left: 0;
    }
    .goal-box-right {
        border-right: none;
        right: 0;
    }
    .penalty-box-left, .penalty-box-right {
        position: absolute;
        width: 60px;
        height: 120px;
        border: 2px solid white;
        top: 50%;
        transform: translateY(-50%);
    }
    .penalty-box-left {
        border-left: none;
        left: 0;
    }
    .penalty-box-right {
        border-right: none;
        right: 0;
    }
    .goal-left, .goal-right {
        position: absolute;
        width: 6px;
        height: 30px;
        background-color: white;
        top: 50%;
        transform: translateY(-50%);
    }
    .goal-left {
        left: -3px;
    }
    .goal-right {
        right: -3px;
    }
    .halfway-line {
        position: absolute;
        width: 2px;
        height: 100%;
        background-color: white;
        left: 50%;
        transform: translateX(-50%);
    }
    .player-dot {
        position: absolute;
        width: 8px;
        height: 8px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: black;
        font-weight: bold;
        font-size: 12px;
        transform: translate(-50%, -50%);
        z-index: 5;
    }
    .player-dot.transferred-in {
        position: absolute;
        width: 8px;
        height: 8px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: black;
        font-weight: bold;
        font-size: 12px;
        transform: translate(-50%, -50%);
        z-index: 5;
    }
    @keyframes pulse {
        0% { box-shadow: 0 0 0 0 rgba(76, 175, 80, 0.7); }
        70% { box-shadow: 0 0 0 5px rgba(76, 175, 80, 0); }
        100% { box-shadow: 0 0 0 0 rgba(76, 175, 80, 0); }
    }
    .player-name {
        position: absolute;
        font-size: 14px;
        font-weight: bold;
        transform: translate(-50%, 5px);
        width: 70px;
        text-align: center;
        white-space: wrap;
        overflow: visible;
        text-overflow: ellipsis;
    }
    .position-GK {
        background-color: #4caf50;
    }
    .position-DF, .position-FW {
        background-color: #ffeb3b;
    }
    
    /* Zone des joueurs transférés (sous le terrain) */
    .transferred-out-players {
        margin-top: 10px;
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        align-items: center;
    }

    
    .transferred-out-player-card {
        border-radius: 3px;
        padding: 5px 10px;
        font-size: 0.8rem;
        display: flex;
        flex-direction: column;
    }
    
    .transferred-out-player-name {
        font-weight: bold;
        color: #666;
    }
    
    .transferred-out-player-points {
        color: #e65100;
        font-size: 0.9rem;
        font-weight: bold;
    }
    
    .transferred-out-player-position {
        font-size: 0.7rem;
        color: #999;
        font-style: italic;
    }
    
    .transfer-tag {
        font-size: 0.6rem;
        background-color: #ff9800;
        color: white;
        padding: 1px 3px;
        border-radius: 2px;
        margin-left: 3px;
    }
    
    /* Styles pour la liste view */
    .player-list {
        margin-top: 10px;
    }
    
    .active-players-section, .transferred-out-section {
        margin-bottom: 15px;
    }
    
    .section-title {
        font-size: 0.9rem;
        font-weight: bold;
        color: #3d195b;
        margin-bottom: 8px;
        padding-bottom: 3px;
        border-bottom: 1px solid #3d195b;
    }
    
    .transferred-out-section .section-title {
        color: #e65100;
        border-bottom-color: #ff9800;
    }
    
    .player {
        padding: 8px 10px;
        border-bottom: 1px solid #eee;
        font-size: 0.9rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        background-color: white;
    }
    
    .player:last-child {
        border-bottom: none;
    }
    
    .player-info {
        display: flex;
        align-items: center;
        gap: 8px;
        flex-wrap: wrap;
    }
    
    .player-name {
        font-size: 14px;
		width:60px;
    }
    
    .player-position {
        font-size: 0.8rem;
        color: #666;
        background-color: #f0f0f0;
        padding: 2px 5px;
        border-radius: 3px;
    }
    
    .player-nation {
        font-size: 0.8rem;
        color: #888;
    }
    
    .player-points {
        font-weight: bold;
        color: #3d195b;
        padding: 2px 8px;
        font-size: 0.85rem;
    }
    
    .transferred-out .player-points {
        background-color: #fff3e0;
        color: #e65100;
    }
   
    
    .goalkeeper .player-name::after {
        content: " (G)";
        font-size: 0.8rem;
        color: #4caf50;
        font-weight: normal;
    }
    
    .formation-title {
        margin-top: 10px;
        font-weight: bold;
        color: #3d195b;
    }
    .team-content {
        display: flex;
        flex-direction: column;
        width: 100%;
    }
    .field-view, .list-view {
        margin-top: 10px;
        width: 100%;
    }
    .view-toggle {
        display: flex;
        margin-top: 10px;
    }
    .view-btn {
        padding: 5px 10px;
        background-color: #e0e0e0;
        border: none;
        cursor: pointer;
        margin-right: 5px;
        border-radius: 3px;
        font-size: 0.8rem;
    }
    .view-btn.active {
        background-color: #3d195b;
        color: white;
    }
    .phase-badge {
        display: inline-block;
        background-color: #3d195b;
        color: white;
        padding: 3px 8px;
        border-radius: 3px;
        font-size: 0.7rem;
        margin-left: 5px;
    }
    @media (max-width: 1024px) {
        .team-card {
            flex: 1 1 100%;
        }
        .soccer-field {
            height: 200px;
        }
    }

    @media (max-width: 768px) {
        .container {
            padding: 15px;
        }
        header {
            padding: 12px 8px;
        }
        h1 {
            font-size: 1.5rem;
        }
        h2 {
            font-size: 1.3rem;
        }
        .section {
            padding: 12px;
        }
        th, td {
            padding: 8px 6px;
            font-size: 0.85rem;
        }
        .team-card {
            flex: 1 1 100%;
        }
        .soccer-field {
            height: 180px;
        }
        .player-name {
            font-size: 10px;
            width: 60px;
        }
    }

    @media (max-width: 480px) {
        .container {
            padding: 10px;
        }
        header {
            padding: 10px 5px;
        }
        h1 {
            font-size: 1.3rem;
        }
        h2 {
            font-size: 1.1rem;
        }
        .tab {
            padding: 6px 10px;
            font-size: 0.8rem;
        }
        .section {
            padding: 10px;
        }
        th, td {
            padding: 6px 4px;
            font-size: 0.8rem;
        }
        .soccer-field {
            height: 150px;
        }
        .center-circle {
            width: 50px;
            height: 50px;
        }
        .penalty-box-left, .penalty-box-right {
            width: 50px;
            height: 100px;
        }
        .player-name {
            font-size: 9px;
            width: 50px;
        }
        .transferred-out-player-card {
            padding: 3px 6px;
            font-size: 0.7rem;
        }
    }
    .rules-content {
        line-height: 1.6;
    }

    .rules-content h3 {
        color: #3d195b;
        margin-top: 20px;
        padding-bottom: 5px;
        border-bottom: 1px solid #eee;
    }

    .rules-content ul, .rules-content ol {
        padding-left: 20px;
        margin: 10px 0;
    }

    .rules-content li {
        margin-bottom: 5px;
    }

    .points-table {
        width: 100%;
        border-collapse: collapse;
        margin: 15px 0;
    }

    .points-table th, .points-table td {
        padding: 10px;
        border: 1px solid #ddd;
        text-align: left;
    }

    .points-table th {
        background-color: #f2f2f2;
        font-weight: bold;
    }

    .points-table tr:nth-child(even) {
        background-color: #f9f9f9;
    }

    @media (max-width: 768px) {
        .points-table th, .points-table td {
            padding: 8px;
            font-size: 0.85rem;
        }
    }
    </style>

</head>

<body>

    <div class="container">
        <header>
            <h1>Paris entre amis</h1>
            <p>WC 2026</p>
        </header>

        <div class="tabs">
            <button class="tab active" onclick="openTab('teams')">Équipes</button>
            <button class="tab" onclick="openTab('standings')">Classement</button>
            <button class="tab" onclick="openTab('stats')">Statistiques</button>
            <button class="tab" onclick="openTab('bracket')">Bracket</button>
            <button class="tab" onclick="openTab('rules')">Règles</button>
            <button class="tab" onclick="openTab('palma')">Palmarès</button>
            <button class="tab" onclick="openTab('transfers')">Transferts</button>
        </div>

        <!-- Section Équipes -->    
        <div id="teams" class="tab-content active">
            <div class="section">
                <h2>Composition des Équipes</h2>
                <div class="team-container" id="team-container">
                    <div class="loading">Chargement des données...</div>
                </div>
            </div>
        </div>

        <!-- Section Palmarès -->    
        <div id="palma" class="tab-content">
            <div class="section">
                <h2>Palmarès 2024</h2>
                <table id="2024-ranking">
                    <thead>
                        <tr>
                            <th>Position</th>
                            <th>Nom</th>
                            <th>Total</th>
                        </tr>
                    </thead>
                   <tbody>
    <tr>
      <td>1</td>
      <td>Christophe</td>
      <td>155</td>
    </tr>
    <tr>
      <td>2</td>
      <td>Bugnon</td>
      <td>149</td>
    </tr>
    <tr>
      <td>3</td>
      <td>Nathan</td>
      <td>134</td>
    </tr>
    <tr>
      <td>4</td>
      <td>Pedzou</td>
      <td>132</td>
    </tr>
    <tr>
      <td>5</td>
      <td>Julien</td>
      <td>131</td>
    </tr>
    <tr>
      <td>6</td>
      <td>Guillaume</td>
      <td>130</td>
    </tr>
    <tr>
      <td>7</td>
      <td>Colin</td>
      <td>127</td>
    </tr>
    <tr>
      <td>8</td>
      <td>Sébastien</td>
      <td>121</td>
    </tr>
    <tr>
      <td>9</td>
      <td>Matthieu</td>
      <td>120</td>
    </tr>
    <tr>
      <td>10</td>
      <td>Marc</td>
      <td>118</td>
    </tr>
    <tr>
      <td>11</td>
      <td>Cyril</td>
      <td>116</td>
    </tr>
    <tr>
      <td>12</td>
      <td>Bryan</td>
      <td>115</td>
    </tr>
    <tr>
      <td>13</td>
      <td>Leo</td>
      <td>107</td>
    </tr>
   <tr style="background-color: #ffcccc;">
      <td>14</td>
      <td><strong>Patrick</strong></td>
      <td>105</td>
    </tr>
    <tr style="background-color: #ffcccc;">
      <td>15</td>
      <td><strong>Josselin</strong></td>
      <td>92</td>
    </tr>
  </tbody>
                </table>
            </div>
        </div>

    <!-- Section Transferts -->
<div id="transfers" class="tab-content">
    <div class="section">
        <h2>Période de Transferts</h2>
        <div class="transfer-period">
            <h4>Fenêtre de Transferts - Après les 1/16èmes de finale</h4>
            <p>Chaque manager peut transférer <strong>2 joueurs maximum</strong> avant le début des 1/16èmes de finale.</p>
            <p><strong>Ordre :</strong> Le dernier du classement choisit en premier, puis remontée jusqu'au premier.  Deuxième tour: du premier au dernier. Inverse du tour 1</p>
            <p><em>Note: Les joueurs transférés conservent leurs points de la phase de groupes, et le coach garde ses points dans son total. Les joueurs commencent à marquer des points pour leur nouveau coach à partir des 1/8èmes. </em></p>
        </div>
        
        <h3>Historique des Transferts</h3>
        <table id="transfers-table">
            <thead>
                <tr>
                    <th>Équipe</th>
                    <th>Joueur Sortant</th>
                    <th>Joueur Entrant</th>
                    <th>Position</th>
                    <th>Tour</th>
                </tr>
            </thead>
            <tbody id="transfers-body">
                <tr>
                    <td colspan="5" class="loading">Chargement des données...</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

    <!-- Section Règles -->
<div id="rules" class="tab-content">
    <div class="section">
        <h2>Règles du Jeu</h2>
        <div class="rules-content">
            <h3>Objectif du jeu</h3>
            <p>Chaque participant compose une équipe de 6 joueurs (1 gardien, 2 défensifs et 3 offensifs ou 1 gardien, 3 défensifs et 2 offensifs) qui marquent des points selon leurs performances pendant la Coupe du Monde 2026. Les milieux de terrain sont considéré comme offensifs</p>
            
            <h3>Composition des équipes</h3>
        Les équipes sont construites à la base d'une draft. Le tirage au sort de l'ordre de draft donne une chance égale à chacun d'être #1. La draft aura lieu sur le groupe Whatsapp. Il faudra annoncé le nom complet du joueur choisi, sa position et sa nationalité.
            <ul>
                <li>1-2-3</li>
                <li>1-3-2 </li>
            </ul>
            A choix et peut changer si des transfers de joueurs sont introduits.

            <h3> Période de Transferts</h3>
            <p><strong>Après les 1/32èmes de finale</strong>, une fenêtre de transferts est ouverte :</p>
            <ul>
                <li>Chaque équipe peut transférer <strong>maximum 2 joueurs</strong></li>
                <li><strong>Ordre: </strong> : Le dernier du classement après les 1/16èmes choisit en premier. Deuxième tour: du premier au dernier. Inverse du tour 1</li>
                <li>Un manager peut choisir de ne pas faire de transfert à son tour</li>
                <li>Les joueurs transférés <strong>conservent leurs points</strong> de la phase de groupes. Leur manager à ce moment conserve ces points</li>
                <li>Les nouveaux joueurs <strong>commencent à marquer des points à partir des 1/16èmes</strong> de finale. Premier tour du Bracket pour les manager</li>
                <li>La formation peut changer si les positions des nouveaux joueurs sont différentes. Mais toujours en restant dans un 1-2-3 ou 1-3-2</li>
            </ul>
            <p>Cette mécanique permet aux équipes mal classées de se renforcer et de rester compétitives pour la phase à élimination directe !</p>

            <h3>Système de points</h3>
            <table class="points-table">
                <thead>
                    <tr>
                        <th>Fait de jeu</th>
                        <th>Gardien</th>
                        <th>Défenseur</th>
                        <th>Attaquant</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Match de groupe gagné</td>
                        <td>+2</td>
                        <td>+2</td>
                        <td>+2</td>
                    </tr>
                    <tr>
                        <td>Match élimination directe gagné</td>
                        <td>+3</td>
                        <td>+3</td>
                        <td>+3</td>
                    </tr>
                    <tr>
                        <td>But marqué</td>
                        <td>+15</td>
                        <td>+10</td>
                        <td>+9</td>
                    </tr>
                    <tr>
                        <td>Passe décisive</td>
                        <td>+7</td>
                        <td>+5</td>
                        <td>+5</td>
                    </tr>
                    <tr>
                        <td>Hat-trick</td>
                        <td>+5</td>
                        <td>+5</td>
                        <td>+5</td>
                    </tr>
                    <tr>
                        <td>Clean sheet</td>
                        <td>+5</td>
                        <td>+2</td>
                        <td>-</td>
                    </tr>
                    <tr>
                        <td>Carton jaune</td>
                        <td>-3</td>
                        <td>-3</td>
                        <td>-3</td>
                    </tr>
                    <tr>
                        <td>Carton rouge</td>
                        <td>-10</td>
                        <td>-10</td>
                        <td>-10</td>
                    </tr>
                    <tr>
                        <td>Match gagné avec +4 buts d'écart</td>
                        <td>+2</td>
                        <td>+2</td>
                        <td>+2</td>
                    </tr>
                    <tr>
                        <td>Arrêt de penalty</td>
                        <td>+3</td>
                        <td>-</td>
                        <td>-</td>
                    </tr>
                    <tr>
                        <td>But en prolongation</td>
                        <td>+2</td>
                        <td>+2</td>
                        <td>+2</td>
                    </tr>
                    <tr>
                        <td>+10 tirs cadrés concédés mais victoire</td>
                        <td>+2</td>
                        <td>+2</td>
                        <td>-</td>
                    </tr>
                </tbody>
            </table>
            
           
            <ul> </ul>
            <h3>Phase à élimination directe / Tournoi "Bracket"</h3>
            La phase de groupe de la Coupe de Monde est de 3 matchs. Les équipes qualifiés passent en 16ème de finale.
        Pour notre jeu les 3 matchs de poules (M1, M2, M3) et les 16ème de finale donneront un total d'accession à chacun. En prenant le classement après les 16èmes de finale nous commenceront un tableau de match à élimination direct ("Bracket"). 
        On ne se battra plus pour faire le plus de points, mais juste plus de points que notre adversaire direct. On avancera jusqu'à la finale qui définiera le vainqueur final. Cependant les points et le classement général continueront de faire valeur pour deux raisons:
1. En cas d'égalité dans un match de Bracket, l'équipe avec le plus de points au total passe; 2. pour au final définir les 2 perdants responsables d'organiser un apéro lors de la soirée d'ouverture de la prochaine compétition (Euro 28). Si un des deux derniers venait à gagner le tournoi "bracket", il sera dispensé de sa charge et l'antépénultième prendra sa place.
            
        <p>Le premier round des matchs est défini comme suit:</p>
            <p>1            vs            16
            ------
            8            vs            9
            ------
            5            vs            12
            ------
            4            vs            13</p>
        

        
        <p>3            vs            14
            ------
            11            vs            6
            ------
            7            vs            10
            ------
            15            vs            2</p>
        
        <ul> </ul>
            <h3>Transfers (Rappel)</h3>
Avant le début de la bracket (après les 1/32èmes) un double tour de draft permettra de changé 2 joueurs. On commence par le dernier du classement jusqu'au premier et retour. Il n'y a aucune obligation de procédé à un transfers une fois son tour venu.
<ul> </ul>
        <h3>Règles supplémentaires</h3>
            <ul>
                <li>En cas d'égalité au classement, le départage se fait par : 
                    <ol>
                        <li>Total de buts marqués par les joueurs de l'équipe</li>
                        <li>Tirage au sort</li>
                    </ol>
                </li>
                <li>Les séances tirs au but ne rapportent pas de points. Les points détaillés s'arrêtent à la fin de la prolongation les pénaltys ne servent qu'à définir dle vainqueur du match.</li>
            </ul>
        </div>
    </div>
</div>

        <!-- Section Classement -->
        <div id="standings" class="tab-content">
            <div class="section">
                <h2>Classement</h2>
                <table id="standings-table">
                    <thead>
                        <tr>
                            <th>Position</th>
                            <th>Équipe</th>
                            <th>M1</th>
                            <th>M2</th>
                            <th>M3</th>
                            <th>1/16</th>
                            <th>1/8</th>
                            <th>1/4</th>
                            <th>1/2</th>
                            <th>Final</th>
                            <th>Pts</th>
                            <th>Transferts</th>
                        </tr>
                    </thead>
                    <tbody id="standings-body">
                        <tr>
                            <td colspan="12" class="loading">Chargement des données...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Section Bracket -->
        <div id="bracket" class="tab-content">
            <div class="section">
                <h2 id="bracket-title">Tournament Bracket</h2>
                <div class="bracket-section">
                    <div class="bracket-container" id="bracket-container">
                        <div class="loading">Chargement des données...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section Statistiques -->
        <div id="stats" class="tab-content">
            <div class="section">
                <h2>Statistiques des Joueurs</h2>
                <table id="player-stats-table">
                    <thead>
                        <tr>
                            <th>Nom</th>
                            <th>Nation</th>
                            <th>Position</th>
                            <th>Équipe</th>
                            <th>M1</th>
                            <th>M2</th>
                            <th>M3</th>
                            <th>1/16</th>
                            <th>1/8</th>
                            <th>1/4</th>
                            <th>1/2</th>
                            <th>Final</th>
                            <th>Total</th>
                        </tr>
                    </thead>
                    <tbody id="player-stats-body">
                        <tr>
                            <td colspan="14" class="loading">Chargement des données...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

     <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyC3zpS_NT8sHN4j0upcAd8jmpfhsgXtdRw",
            authDomain: "paris-entre-amis-598e9.firebaseapp.com",
            projectId: "paris-entre-amis-598e9",
            storageBucket: "paris-entre-amis-598e9.firebasestorage.app",
            messagingSenderId: "638642602040",
            appId: "1:638642602040:web:0f7557f7d4923b6aec26cd"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        document.addEventListener('DOMContentLoaded', () => {
            loadAllData();
        });

        // Function to handle tabs
        function openTab(tabName) {
            const tabContents = document.getElementsByClassName("tab-content");
            for (let i = 0; i < tabContents.length; i++) {
                tabContents[i].classList.remove("active");
            }
            const tabs = document.getElementsByClassName("tab");
            for (let i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove("active");
            }         
            document.getElementById(tabName).classList.add("active");
            event.currentTarget.classList.add("active");
        }

        // Function to toggle between field/list views for each team
        function toggleView(teamId, viewType) {
            const fieldView = document.getElementById(`field-view-${teamId}`);
            const listView = document.getElementById(`list-view-${teamId}`);
            const fieldBtn = document.getElementById(`field-btn-${teamId}`);
            const listBtn = document.getElementById(`list-btn-${teamId}`);
            if (viewType === 'field') {
                fieldView.style.display = 'block';
                listView.style.display = 'none';
                fieldBtn.classList.add('active');
                listBtn.classList.remove('active');
            } else {
                fieldView.style.display = 'none';
                listView.style.display = 'block';
                fieldBtn.classList.remove('active');
                listBtn.classList.add('active');
            }
        }

        // Main function to load all data from Firestore
       async function loadAllData() {
    try {
        // Load teams data
        const teamsSnapshot = await db.collection("teams").get();
        const teams = teamsSnapshot.docs.map(doc => {
            const data = doc.data();
            return {
                id: doc.id,
                name: data.name,
                shortName: data.shortName || data.name.substring(0, 3).toUpperCase(),
                formation: data.formation || "1-2-3",
                players: data.players || [],
                results: data.results || {},
                transfersUsed: data.transfersUsed || 0,
                transferHistory: data.transferHistory || []
            };
        });

        // Load tournament settings to check if bracket should be shown
        const tournamentSettings = await db.collection("tournament").doc("general").get();
        const showBracket = tournamentSettings.exists && tournamentSettings.data().start === true;
        const transferWindowOpen = tournamentSettings.exists && tournamentSettings.data().transferWindowOpen === true;

        // Load bracket data only if needed
        let bracketData = {};
        if (showBracket) {
            const bracketDoc = await db.collection("tournament").doc("bracket").get();
            bracketData = bracketDoc.exists ? bracketDoc.data() : {};
        }

        // Load player stats
        const playersSnapshot = await db.collection("players").get();
        const playerStats = playersSnapshot.docs.map(doc => {
            const data = doc.data();
            return {
                name: data.name,
                nation: data.nation, 
                equipe: data.team,
                position: data.position || 'FW',
                transferStatus: data.transferStatus || 'original', // 'original', 'transferred_in', 'transferred_out'
                transferredFrom: data.transferredFrom || null, // Previous team if transferred out
                transferredTo: data.transferredTo || null, // New team if transferred in
                transferRound: data.transferRound || null, // 1 or 2
                pointsAtTransfer: data.pointsAtTransfer || calculatePlayerTotalPointsBeforeTransfer(data.matches), // Points when transferred out
                matches: data.matches || {}
            };
        });

        // Load transfers data
        const transfersSnapshot = await db.collection("transfers").get();
        const transfers = transfersSnapshot.docs.map(doc => {
            const data = doc.data();
            return {
                id: doc.id,
                team: data.team,
                playerOut: data.playerOut,
                playerIn: data.playerIn,
                position: data.position,
                round: data.round,
                timestamp: data.timestamp
            };
        });

        // Render all data
        renderTeams(teams, playerStats);
        renderStandings(teams);
        renderPlayerStats(playerStats);
        renderTransfers(transfers);
        
        // Show transfer window indicator
        if (transferWindowOpen) {
            document.querySelector('.tab[onclick="openTab(\'transfers\')"]').style.backgroundColor = '#ff9800';
            document.querySelector('.tab[onclick="openTab(\'transfers\')"]').style.color = 'white';
        }
        
        // Only render bracket if enabled
        if (showBracket) {
            renderBracket({
                teams: teams,
                bracket: bracketData
            });
            document.querySelector('.tab[onclick="openTab(\'bracket\')"]').style.display = 'block';
        } else {
            document.querySelector('.tab[onclick="openTab(\'bracket\')"]').style.display = 'none';
        }

    } catch (error) {
        console.error("Error loading data:", error);
        // Show error messages in each section
        document.getElementById('team-container').innerHTML = 
            `<p class="error">Error loading team data: ${error.message}</p>`;
        document.getElementById('standings-body').innerHTML = 
            `<tr><td colspan="12" class="error">Error loading standings: ${error.message}</td></tr>`;
        document.getElementById('player-stats-body').innerHTML = 
            `<tr><td colspan="14" class="error">Error loading player stats: ${error.message}</td></tr>`;
        document.getElementById('transfers-body').innerHTML = 
            `<tr><td colspan="5" class="error">Error loading transfers: ${error.message}</td></tr>`;
        document.getElementById('bracket-container').innerHTML = 
            `<p class="error">Error loading bracket: ${error.message}</p>`;
    }
}

        // Helper function to calculate player points before transfer (only group stage matches)
        function calculatePlayerTotalPointsBeforeTransfer(matches) {
            if (!matches) return 0;
            // Only count M1, M2, M3, F32 (group stage matches)
            const groupMatches = ['M1', 'M2', 'M3', 'F32'];
            let total = 0;
            groupMatches.forEach(matchKey => {
                if (matches[matchKey]) {
                    total += matches[matchKey];
                }
            });
            return total;
        }

        // Function to render teams with improved field and list views
       function renderTeams(teams, playerStatsData) {
    const teamContainer = document.getElementById('team-container');
    teamContainer.innerHTML = '';

    // Organiser les joueurs par équipe
    const playersByTeam = {};
    
    // Initialiser les tableaux pour chaque équipe
    teams.forEach(team => {
        playersByTeam[team.id] = [];
    });
    
    // Ajouter chaque joueur dans son équipe actuelle
    playerStatsData.forEach(player => {
        if (player.equipe && playersByTeam[player.equipe]) {
            playersByTeam[player.equipe].push(player);
        }
    });

    teams.forEach((team, teamIndex) => {
        const teamCard = document.createElement('div');
        teamCard.className = 'team-card';

        // Récupérer tous les joueurs de cette équipe
        const allTeamPlayers = playersByTeam[team.id] || [];
        
        // Séparer les joueurs actifs et les joueurs transférés (qui ont quitté l'équipe)
        // Note: Les joueurs transférés ont transferStatus = 'transferred_out' mais sont encore dans l'équipe ?
        // En réalité, les joueurs transférés ne sont plus dans l'équipe. Nous devons les trouver ailleurs.
        
        // Pour cet exemple, nous allons considérer que les joueurs avec transferStatus = 'transferred_out' 
        // ne sont plus dans l'équipe. Les joueurs actifs sont ceux avec transferStatus !== 'transferred_out'
        const activePlayers = allTeamPlayers.filter(p => p.transferStatus !== 'transferred_out');
        const transferredOutPlayers = allTeamPlayers.filter(p => p.transferStatus === 'transferred_out');
        
        // Déterminer dynamiquement la formation basée sur les positions des joueurs actifs
        const formation = determineFormation(activePlayers);
        
        // Trier les joueurs actifs
        const sortedActivePlayers = [...activePlayers].sort((a, b) => {
            // D'abord les transferts entrants (pour les mettre en évidence)
            if (a.transferStatus === 'transferred_in' && b.transferStatus !== 'transferred_in') return -1;
            if (a.transferStatus !== 'transferred_in' && b.transferStatus === 'transferred_in') return 1;
            
            // Ensuite par round (croissant)
            const roundA = a.round || 999;
            const roundB = b.round || 999;
            
            if (roundA !== roundB) {
                return roundA - roundB;
            }
            
            // Ensuite par position (GK, DF, FW)
            const posOrder = { 'GK': 1, 'DF': 2, 'FW': 3 };
            return (posOrder[a.position] || 99) - (posOrder[b.position] || 99);
        });
        
        // Créer la vue liste avec deux sections
        let activePlayersHtml = '';
        let transferredOutHtml = '';
        
        // Section des joueurs actifs
        sortedActivePlayers.forEach(player => {
            const isGoalkeeper = player.position === 'GK';
            const positionName = isGoalkeeper ? 'Gardien' : 
                                player.position === 'DF' ? 'Défenseur' : 'Attaquant';
            
            const totalPoints = calculatePlayerTotalPoints(player.matches);
            const draftRound = player.round ? `Round ${player.round}` : '';
            
            // Déterminer la classe CSS en fonction du statut de transfert
            let transferBadge = '';
            let playerClass = '';
            
            if (player.transferStatus === 'transferred_in') {
                playerClass = 'transferred-in';
            }
            
            activePlayersHtml += `
                <div class="player ${isGoalkeeper ? 'goalkeeper' : ''}">
                    ${player.name} (${positionName}, ${player.nation || ''})
                    <span class="player-details">
                        ${draftRound}
                        <span class="player-points">${totalPoints} pts</span>
                    </span>
                </div>
            `;
        });
        
        // Section des joueurs transférés (sortis)
        transferredOutPlayers.forEach(player => {
            const positionName = player.position === 'GK' ? 'Gardien' : 
                                player.position === 'DF' ? 'Défenseur' : 'Attaquant';
            
            // Utiliser les points au moment du transfert ou calculer les points de groupe
            const pointsAtTransfer = player.pointsAtTransfer || calculatePlayerTotalPointsBeforeTransfer(player.matches);
            
            transferredOutHtml += `
                <div class="player">
					${player.name} (${positionName}, ${player.nation || ''})
                    <span class="player-points">${pointsAtTransfer} pts</span>
                </div>
            `;
        });

        // Créer le HTML de la carte équipe avec les deux vues
        teamCard.innerHTML = `
            <h3>
                ${team.name} 
            </h3>
            <div class="view-toggle">
                <button id="field-btn-${teamIndex}" class="view-btn active" onclick="toggleView(${teamIndex}, 'field')">Vue Terrain</button>
                <button id="list-btn-${teamIndex}" class="view-btn" onclick="toggleView(${teamIndex}, 'list')">Vue Liste</button>
            </div>
            
            <div class="formation-title">Formation actuelle: ${formation}</div>
            
            <div class="team-content">
                <!-- Vue Terrain -->
                <div id="field-view-${teamIndex}" class="field-view">
                    <div class="field-wrapper">
                        <div class="soccer-field" style="position: relative;">
                            <!-- Field lines -->
                            <div class="halfway-line"></div>
                            <div class="center-circle"></div>
                            <div class="center-spot"></div>
                            <div class="penalty-box-left"></div>
                            <div class="penalty-box-right"></div>
                            <div class="goal-box-left"></div>
                            <div class="goal-box-right"></div>
                            <div class="goal-left"></div>
                            <div class="goal-right"></div>
                        </div>
                        
						<div class="formation-title">Transfert</div>
                        <!-- Joueurs transférés affichés sous le terrain -->
                        ${transferredOutPlayers.length > 0 ? `
                        <div class="transferred-out-players">
                            ${transferredOutPlayers.map(player => {
                                const pointsAtTransfer = player.pointsAtTransfer || calculatePlayerTotalPointsBeforeTransfer(player.matches);
                                const positionName = player.position === 'GK' ? 'G' : player.position === 'DF' ? 'D' : 'A';
                                return `
                                    
									<div class="player">
                    ${player.name} (${positionName}, ${player.nation || ''})
                    <span class="player-details">
                       
                        <span class="player-points">${pointsAtTransfer} pts</span>
                    </span>
                </div>
                                `;
                            }).join('')}
                        </div>
                        ` : ''}
                    </div>
                </div>
                
                <!-- Vue Liste -->
                <div id="list-view-${teamIndex}" class="list-view" style="display: none;">
                    <div class="player-list">
                        <!-- Section des joueurs actifs -->
                        <div class="active-players-section">
                            <div class="section-title">Équipe active (6 joueurs)</div>
                            ${activePlayersHtml || '<p>Aucun joueur actif</p>'}
                        </div>
                        
                        <!-- Section des joueurs transférés -->
                        ${transferredOutPlayers.length > 0 ? `
                        <div class="transferred-out-section">
                            <div class="section-title">Joueurs transférés</div>
                            ${transferredOutHtml}
                        </div>
                        ` : ''}
                    </div>
                </div>
            </div>
        `;

        teamContainer.appendChild(teamCard);

        // Ajouter les joueurs actifs sur le terrain
        const soccerField = teamCard.querySelector('.soccer-field');
        placePlayersOnField(sortedActivePlayers, soccerField, formation);
    });
}

         // Fonction pour déterminer la formation en fonction des positions des joueurs
function determineFormation(players) {
    if (!players || players.length === 0) return "1-2-3"; // Formation par défaut

    // Compter le nombre de joueurs par position
    let goalkeepers = 0;
    let defenders = 0;
    let forwards = 0;

    players.forEach(player => {
        if (player.position === 'GK') goalkeepers++;
        else if (player.position === 'DF') defenders++;
        else if (player.position === 'FW') forwards++;
    });

    // S'assurer qu'il y a au moins un gardien
    if (goalkeepers === 0) goalkeepers = 1;

    // Déterminer la formation en fonction de la prédominance des positions
    // Si plus de défenseurs, formation 1-3-2, sinon 1-2-3
    if (defenders >= 3) {
        return "1-3-2";
    } else {
        return "1-2-3";
    }
}

        // Function to place players on the field based on formation
        function placePlayersOnField(players, fieldElement, formation) {
            // Position mapping based on formation
            let positionMapping;
            
            if (formation === "1-2-3") {
                // Formation 1-2-3 (1 GK, 2 DF, 3 FW)
                positionMapping = {
                    'GK': { x: 15, y: 45 },
                    'DF1': { x: 35, y: 25 },
                    'DF2': { x: 35, y: 60 },
                    'FW1': { x: 65, y: 15 },
                    'FW2': { x: 65, y: 45 },
                    'FW3': { x: 65, y: 75 }
                };
            } else {
                // Formation 1-3-2 (1 GK, 3 DF, 2 FW)
                positionMapping = {
                    'GK': { x: 15, y: 45 },
                    'DF1': { x: 35, y: 15 },
                    'DF2': { x: 35, y: 45 },
                    'DF3': { x: 35, y: 75 },
                    'FW1': { x: 65, y: 25 },
                    'FW2': { x: 65, y: 60 }
                };
            }
            
            // Sort players by position (GK, DF, FW)
            const sortedPlayers = [...players].sort((a, b) => {
                const posOrder = { 'GK': 0, 'DF': 1, 'FW': 2 };
                return posOrder[a.position] - posOrder[b.position];
            });
            
            // Count defenders and forwards for placement
            let dfCount = 0;
            let fwCount = 0;
            
            sortedPlayers.forEach(player => {
                const playerDot = document.createElement('div');
                playerDot.className = `player-dot position-${player.position} ${player.transferStatus === 'transferred_in' ? 'transferred-in' : ''}`;
                
                // Determine field position
                let position;
                
                if (player.position === 'GK') {
                    position = positionMapping['GK'];
                } else if (player.position === 'DF') {
                    dfCount++;
                    const posKey = `DF${dfCount}`;
                    position = positionMapping[posKey] || positionMapping['DF1'];
                } else if (player.position === 'FW') {
                    fwCount++;
                    const posKey = `FW${fwCount}`;
                    position = positionMapping[posKey] || positionMapping['FW1'];
                } else {
                    // Default to center
                    position = { x: 50, y: 50 };
                }
                
                // Position the player
                playerDot.style.left = `${position.x}%`;
                playerDot.style.top = `${position.y}%`;
                               
                // Add player name below
                const playerName = document.createElement('div');
                playerName.className = 'player-name';
                playerName.textContent = player.name + (player.transferStatus === 'transferred_in' ? ' (N)' : '');
                playerName.style.left = `${position.x}%`;
                playerName.style.top = `${position.y}%`;
                
                fieldElement.appendChild(playerDot);
                fieldElement.appendChild(playerName);
            });
        }

        // Function to render standings with transfers info
        function renderStandings(teams) {
    const standingsBody = document.getElementById('standings-body');
    standingsBody.innerHTML = '';

    // Créer un objet pour stocker les totaux des équipes par match
    const teamPointsByMatch = {};
    teams.forEach(team => {
        teamPointsByMatch[team.id] = {
            M1: 0, M2: 0, M3: 0, F32: 0, F16: 0, F8: 0, F4: 0, Final: 0
        };
    });

    // Parcourir tous les joueurs pour calculer les points des équipes
    db.collection("players").get().then(playersSnapshot => {
        const players = playersSnapshot.docs.map(doc => doc.data());
        
        // Pour chaque joueur, ajouter ses points à son équipe
        players.forEach(player => {
            if (player.team && player.matches) {
                const teamId = player.team;
                
                // Si l'équipe existe dans notre liste
                if (teamPointsByMatch[teamId]) {
                    // Pour les joueurs transférés, ils conservent leurs points de groupe
                    // mais leurs points après transfert vont à leur nouvelle équipe
                    for (const [matchKey, points] of Object.entries(player.matches)) {
                        if (teamPointsByMatch[teamId][matchKey] !== undefined) {
                            teamPointsByMatch[teamId][matchKey] += (points || 0);
                        }
                    }
                }
            }
        });

        // Maintenant, nous pouvons trier et afficher les équipes
        const sortedStandings = [...teams].sort((a, b) => {
            const totalA = calculateTeamTotalPointsDynamic(teamPointsByMatch[a.id] || {});
            const totalB = calculateTeamTotalPointsDynamic(teamPointsByMatch[b.id] || {});
            return totalB - totalA;
        });

        sortedStandings.forEach((team, index) => {
            const row = document.createElement('tr');
            const teamPoints = teamPointsByMatch[team.id] || {};
            const totalPoints = calculateTeamTotalPointsDynamic(teamPoints);

            row.innerHTML = `
                <td>${index + 1}</td>
                <td>${team.name}</td>
                <td>${teamPoints.M1 || 0}</td>
                <td>${teamPoints.M2 || 0}</td>
                <td>${teamPoints.M3 || 0}</td>
                <td>${teamPoints.F32 || 0}</td>
                <td>${teamPoints.F16 || 0}</td>
                <td>${teamPoints.F8 || 0}</td>
                <td>${teamPoints.F4 || 0}</td>
                <td>${teamPoints.Final || 0}</td>
                <td><strong>${totalPoints}</strong></td>
                <td>${team.transfersUsed || 0}/2</td>
            `;
            standingsBody.appendChild(row);
        });
    }).catch(error => {
        console.error("Error loading player data for standings:", error);
        standingsBody.innerHTML = `<tr><td colspan="12" class="error">Error loading data: ${error.message}</td></tr>`;
    });
}

        // Helper function to calculate team total points
        function calculateTeamTotalPoints(results) {
            if (!results) return 0;
            return Object.values(results).reduce((sum, val) => sum + (val || 0), 0);
        }

         function calculateTeamTotalPointsDynamic(matchPoints) {
    if (!matchPoints) return 0;
    return Object.values(matchPoints).reduce((sum, val) => sum + (val || 0), 0);
}

        function renderBracket(tournamentData) {
    const container = document.getElementById('bracket-container');
    container.innerHTML = '';
    
    if (!tournamentData || !tournamentData.bracket) {
        container.innerHTML = '<p>No bracket data available</p>';
        return;
    }

    // Create rounds in order with proper fallbacks
    const rounds = [
        { 
            name: "Round of 32", 
            class: "bracket-round-32",
            matches: tournamentData.bracket.roundOf32 || [] 
        },
        { 
            name: "Round of 16", 
            class: "bracket-round-16",
            matches: tournamentData.bracket.roundOf16 || [] 
        },
        { 
            name: "Quarter Finals", 
            class: "bracket-round-8",
            matches: tournamentData.bracket.quarterFinals || [] 
        },
        { 
            name: "Semi Finals", 
            class: "bracket-round-4",
            matches: tournamentData.bracket.semiFinals || [] 
        },
        { 
            name: "FINAL", 
            class: "bracket-round-2 bracket-final",
            matches: tournamentData.bracket.final ? [tournamentData.bracket.final] : [] 
        }
    ];
    
    rounds.forEach(round => {
        if (!round.matches || round.matches.length === 0) return;
        
        const roundDiv = document.createElement('div');
        roundDiv.className = `bracket-round ${round.class}`;
        
        const titleDiv = document.createElement('div');
        titleDiv.className = 'bracket-round-title';
        titleDiv.textContent = round.name;
        if (round.name === "Round of 32") {
            titleDiv.innerHTML += ' <span style="font-size:0.7rem; background:#ff9800; color:white; padding:2px 5px; border-radius:3px; margin-left:5px;">Fin de la phase de groupes</span>';
        }
        roundDiv.appendChild(titleDiv);
        
        round.matches.forEach((match, index) => {
            if (!match) return;
            
            const matchDiv = document.createElement('div');
            matchDiv.className = 'bracket-match';
            
            // Handle team data - fallback to IDs if team objects don't exist
            const team1 = match.team1Id || (match.teamId && typeof match.teamId === 'object' ? match.teamId : { shortName: match.teamId || 'TBD' });
            const team2 = match.team2Id || (match.teamZId && typeof match.teamZId === 'object' ? match.teamZId : { shortName: match.teamZId || 'TBD' });
            
            // Handle scores - some matches might use score1/score2, others might use score
            const score1 = match.score1 !== undefined ? match.score1 : (match.score && match.score[0]);
            const score2 = match.score2 !== undefined ? match.score2 : (match.score && match.score[1]);
            
            // Handle winner - some matches might use winnerId, others might determine from scores
            let winnerId = match.winnerId;
            if (!winnerId && score1 !== undefined && score2 !== undefined) {
                winnerId = score1 > score2 ? match.team1Id || match.teamId : 
                          score2 > score1 ? match.team2Id || match.teamZId : 
                          null; // draw
            }
            
            const topTeam = document.createElement('div');
            topTeam.className = `bracket-team top ${(match.team1Id || match.teamId) === winnerId ? 'winner' : ''}`;
            topTeam.innerHTML = `
                <span>${typeof team1 === 'object' ? team1.shortName : team1}</span>
                ${score1 !== undefined ? 
                    `<span class="bracket-score">${score1}</span>` : ''
                }
                ${match.penaltyScore1 !== undefined ? 
                    `<span class="penalty-score">(${match.penaltyScore1})</span>` : ''
                }
            `;
            
            const bottomTeam = document.createElement('div');
            bottomTeam.className = `bracket-team bottom ${(match.team2Id || match.teamZId) === winnerId ? 'winner' : ''}`;
            bottomTeam.innerHTML = `
                <span>${typeof team2 === 'object' ? team2.shortName : team2}</span>
                ${score2 !== undefined ? 
                    `<span class="bracket-score">${score2}</span>` : ''
                }
                ${match.penaltyScore2 !== undefined ? 
                    `<span class="penalty-score">(${match.penaltyScore2})</span>` : ''
                }
            `;
            
            // Add transfer window indicator after round of 32
            if (round.name === "Round of 32") {
                const transferNote = document.createElement('div');
                transferNote.className = 'match-date';
                transferNote.style.backgroundColor = '#fff3e0';
                transferNote.style.color = '#e65100';
                transferNote.style.padding = '2px';
                transferNote.style.borderRadius = '3px';
                transferNote.textContent = '🔓 Fenêtre de transferts ouverte';
                matchDiv.appendChild(transferNote);
            }
            
            matchDiv.appendChild(topTeam);
            matchDiv.appendChild(bottomTeam);            
            roundDiv.appendChild(matchDiv);
        });
        
        container.appendChild(roundDiv);
    });
}

        // Function to render transfers history
        function renderTransfers(transfers) {
            const transfersBody = document.getElementById('transfers-body');
            transfersBody.innerHTML = '';
            
            if (!transfers || transfers.length === 0) {
                transfersBody.innerHTML = '<tr><td colspan="5" class="loading">Aucun transfert effectué pour le moment</td></tr>';
                return;
            }
            
            // Sort by round and timestamp
            const sortedTransfers = [...transfers].sort((a, b) => {
                if (a.round !== b.round) return a.round - b.round;
                return (a.timestamp || 0) - (b.timestamp || 0);
            });
            
            sortedTransfers.forEach(transfer => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${transfer.team}</td>
                    <td>${transfer.playerOut}</td>
                    <td><strong>${transfer.playerIn}</strong></td>
                    <td>${transfer.position}</td>
                    <td>Tour ${transfer.round}</td>
                `;
                transfersBody.appendChild(row);
            });
        }

        // Helper function to find team by ID
        function findTeamById(teams, id) {
            return teams.find(team => team.id === id) || { 
                name: 'TBD', 
                shortName: 'TBD' 
            };
        }

        // Function to render player statistics with transfer info
        function renderPlayerStats(playerStats) {
            const playerStatsBody = document.getElementById('player-stats-body');
            playerStatsBody.innerHTML = '';

            // Sort by total points (descending)
            const sortedPlayers = [...playerStats].sort((a, b) => {
                const totalA = calculatePlayerTotalPoints(a.matches);
                const totalB = calculatePlayerTotalPoints(b.matches);
                return totalB - totalA;
            });

            sortedPlayers.forEach(player => {
                const row = document.createElement('tr');
                const totalPoints = calculatePlayerTotalPoints(player.matches);
                
                // Add transfer status styling
                let statusText = 'Original';
                let statusStyle = '';
                
                if (player.transferStatus === 'transferred_in') {
                    statusText = `Transféré (R${player.transferRound})`;
                    statusStyle = 'color: #4caf50; font-weight: bold;';
                } else if (player.transferStatus === 'transferred_out') {
                    statusText = 'Transféré (départ)';
                    statusStyle = 'color: #999; text-decoration: line-through;';
                }
                
                row.innerHTML = `
                    <td>${player.name}</td>
                    <td>${player.nation}</td>
                    <td>${player.position}</td>
                    <td>${player.equipe || 'Sans équipe'}</td>
                    <td>${player.matches.M1 || 0}</td>
                    <td>${player.matches.M2 || 0}</td>
                    <td>${player.matches.M3 || 0}</td>
                    <td>${player.matches.F32 || 0}</td>
                    <td>${player.matches.F16 || 0}</td>
                    <td>${player.matches.F8 || 0}</td>
                    <td>${player.matches.F4 || 0}</td>
                    <td>${player.matches.Final || 0}</td>
                    <td><strong>${totalPoints}</strong></td>
                `;
                playerStatsBody.appendChild(row);
            });
        }

        // Helper function to calculate player total points
        function calculatePlayerTotalPoints(matches) {
            if (!matches) return 0;
            return Object.values(matches).reduce((sum, val) => sum + (val || 0), 0);
        }
    </script>
</body>

</html>
